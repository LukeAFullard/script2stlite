<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>Installer App</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@stlite/browser@0.89.0/build/stlite.css"
    />
  </head>
  <body>
    <div id="root"></div>
    <script type="module">
import { mount } from "https://cdn.jsdelivr.net/npm/@stlite/browser@0.89.0/build/stlite.js"
mount(
  {
    sharedWorker: true,
    streamlitConfig : {},
    requirements: ['streamlit'],
    entrypoint: "app.py",
    pyodideUrl: "https://cdn.jsdelivr.net/pyodide/v0.28.2/full/pyodide.js",
    files: {
"app.py": `
import streamlit as st
import os

st.title("Installer App (File Writer)")

st.write(
    "This app is part of a diagnostic test. Its purpose is to write a file "
    "to a shared location (\`/mnt/test.txt\`) in the virtual file system."
)

if st.button("Write the test file"):
    file_path = "/mnt/test.txt"
    dir_name = os.path.dirname(file_path)

    try:
        # Create the directory if it doesn't exist
        if not os.path.exists(dir_name):
            st.write(f"Directory \`{dir_name}\` does not exist. Creating it...")
            os.makedirs(dir_name)
            st.write(f"Directory \`{dir_name}\` created.")

        # Write the file
        content = "Hello from the Installer App! The file was written successfully."
        with open(file_path, "w") as f:
            f.write(content)

        st.success(f"Successfully wrote file to \`{file_path}\`.")
        st.info("You can now go to the 'User App (File Reader)' to see if it can read this file.")

    except Exception as e:
        st.error(f"An error occurred: {e}")

`,

},
  },
  document.getElementById("root")
)

function Ou(n){const i=window.atob(n),a=i.length,l=new Uint8Array(a);for(let u=0;u<a;u++)l[u]=i.charCodeAt(u);return l}
    </script>
  </body>
  <!-- We love stlite! https://github.com/whitphx/stlite and Pyodide https://github.com/pyodide/pyodide -->
</html>